<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="referrer" content="always" />
    <link rel="stylesheet" href="./output.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>halo</title>
  </head>
  <body>
    <script src="./main.js"></script>
    <!-- <script src="../node_modules/flowbite/dist/flowbite.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
    <!-- grafik -->
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" defer></script>
    <script>
      Number.prototype.comma_formatter = function () {
        return this.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
      };

      let chartData = function () {
        return {
          date: "today",
          options: [
            {
              label: "Today",
              value: "today",
            },
            {
              label: "Last 7 Days",
              value: "7days",
            },
            {
              label: "Last 30 Days",
              value: "30days",
            },
            {
              label: "Last 6 Months",
              value: "6months",
            },
            {
              label: "This Year",
              value: "year",
            },
          ],
          showDropdown: false,
          selectedOption: 0,
          selectOption: function (index) {
            this.selectedOption = index;
            this.date = this.options[index].value;
            this.renderChart();
          },
          data: null,
          fetch: function () {
            fetch("https://cdn.jsdelivr.net/gh/swindon/fake-api@master/tailwindAlpineJsChartJsEx1.json")
              .then((res) => res.json())
              .then((res) => {
                this.data = res.dates;
                this.renderChart();
              });
          },
          renderChart: function () {
            let c = false;

            Chart.helpers.each(Chart.instances, function (instance) {
              if (instance.chart.canvas.id == "chart") {
                c = instance;
              }
            });

            if (c) {
              c.destroy();
            }

            let ctx = document.getElementById("chart").getContext("2d");

            let chart = new Chart(ctx, {
              type: "line",
              data: {
                labels: this.data[this.date].data.labels,
                datasets: [
                  {
                    label: "Income",
                    backgroundColor: "rgb(16, 97, 204, 0.25)",
                    borderColor: "rgb(16, 97, 204, 1)",
                    pointBackgroundColor: "rgb(16, 97, 204, 1)",
                    data: this.data[this.date].data.income,
                  },
                  {
                    label: "Expenses",
                    backgroundColor: "rgba(237, 100, 166, 0.25)",
                    borderColor: "rgba(237, 100, 166, 1)",
                    pointBackgroundColor: "rgba(237, 100, 166, 1)",
                    data: this.data[this.date].data.expenses,
                  },
                ],
              },
              layout: {
                padding: {
                  right: 10,
                },
              },
              options: {
                scales: {
                  yAxes: [
                    {
                      gridLines: {
                        display: false,
                      },
                      ticks: {
                        callback: function (value, index, array) {
                          return value > 1000 ? (value < 1000000 ? value / 1000 + "K" : value / 1000000 + "M") : value;
                        },
                      },
                    },
                  ],
                },
              },
            });
          },
        };
      };
    </script>
  </body>
</html>
